angular.module("templates",[]).run(["$templateCache",function(e){e.put("map/map.tpl.html",'<gbif-map key="{{searchController.usageKey}}"></gbif-map>'),e.put("search/search.tpl.html",'<div>\n  <div class="row" id="search">\n    <div class="col-md-12">\n      <alert ng-repeat="alert in searchController.alerts" type="{{alert.type}}" close="searchController.closeAlert($index)">{{alert.content}}</alert>\n      <div class="row">\n        <div class="col-md-8">\n          <table ng-if="searchController.result" class="table table-condensed">\n            <thead>\n            <th>Key</th>\n            <th>Canonical Name</th>\n            <th>Scientific Name</th>\n            <th>Rank</th>\n            </thead>\n            <tbody>\n            <tr ng-click="searchController.setUsageKey(searchController.result.usageKey)">\n              <td>{{searchController.result.usageKey}}</td>\n              <td>{{searchController.result.canonicalName}}</td>\n              <td>{{searchController.result.scientificName}}</td>\n              <td>{{searchController.result.rank}}</td>\n              <td>{{searchController.result.records}}</td>\n            </tr>\n            </tbody>\n          </table>\n        </div>\n        <div class="col-md-4">\n          <form name="form" no-validate>\n            <div class="form-group">\n              <input name="search" type="text" class="form-control"\n                     placeholder="Ex: Animalia, Pica pica, Puma Concolor"\n                     ng-model="searchController.search"\n                     ng-change="searchController.suggest(searchController.search)"\n                     typeahead="suggestion.canonicalName for suggestion in searchController.suggestions"/>\n            </div>\n            <div class="pull-right">\n              <button class="btn btn-default"\n                      ng-click="searchController.find(searchController.search)"\n                      ng-disabled="!searchController.search">Search\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="row">\n    <div class="col-md-10">\n      <div id="map" ng-include="\'map/map.tpl.html\'"></div>\n    </div>\n    <div class="col-md-2">\n      <div id="last-search-requests" class="hidden-sm hidden-xs">\n        <h3>Last search requests</h3>\n        <ul ng-if="(searchController.lastSearches.length > 0)">\n          <li ng-repeat="lastSearch in searchController.lastSearches | limitTo:10">\n            <a ui-sref="search({search:lastSearch})">{{ lastSearch }}</a>\n          </li>\n        </ul>\n        <div ng-if="!(searchController.lastSearches.length > 0)"><span>No previous requests.</span></div>\n        <ul>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>')}]),function(){angular.module("gbif-tool",["ui.bootstrap","ui.router","templates","gbif-search","gbif-map"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/search/"),e.state("search",{url:"/search/:search",templateUrl:"search/search.tpl.html",controller:"SearchController",controllerAs:"searchController"})}]).config(["$httpProvider",function(e){e.interceptors.push("AppHttpInterceptor")}])}(),function(){function e(){}angular.module("gbif-tool").controller("MainController",e)}(),function(){function e(e){return{request:function(t){return e.spinner=!0,t},response:function(t){return e.spinner=!1,t},responseError:function(t){return e.spinner=!1,t}}}angular.module("gbif-tool").factory("AppHttpInterceptor",["$rootScope",e])}(),function(){angular.module("gbif-map",[])}(),function(){function e(){return{setBackground:function(e){var t="http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png";L.tileLayer(t,{subdomains:["otile1","otile2","otile3","otile4"]}).addTo(e)},updateTileLayer:function(e,t,r){var n="http://api.gbif.org/v1/map/density/tile?x={x}&y={y}&z={z}&type=TAXON&palette=yellows_reds&key=";return _.isEmpty(t)||e.removeLayer(t),""!==r&&(t=L.tileLayer(n+r,{maxZoom:18}),t.addTo(e)),t}}}angular.module("gbif-map").factory("MapService",e)}(),function(){function e(e){return{restrict:"E",template:'<div id="gbif-map" class="map"></div>',link:function(t,r,n){var a=L.map("gbif-map",{center:[20,0],zoom:2,minZoom:2});e.setBackground(a);var s;n.$observe("key",function(t){s=e.updateTileLayer(a,s,t)}),t.$on("$destroy",function(){a.remove(),s=null})}}}angular.module("gbif-map").directive("gbifMap",["MapService",e])}(),function(){angular.module("gbif-search",[])}(),function(){function e(e,t){function r(r){e.find(r).then(function(n){"NONE"!==n.data.matchType?(o.result=n.data,o.usageKey=o.result.usageKey,e.storeLastSearch(r),t.go("search",{search:r})):o.alerts.push({type:"info",content:"No results are matching your request"})},function(e){o.alerts.push({type:"danger",content:e})})}function n(t){e.suggest(t).then(function(e){o.suggestions=e.data},function(e){o.alerts.push({type:"warning",content:e})})}function a(e){o.alerts.splice(e,1)}function s(){return e.retrieveLastSearches()}var o=this;o.search=t.params.search?t.params.search:void 0,o.usageKey=void 0,o.result=void 0,o.alerts=[],o.find=r,o.suggest=n,o.closeAlert=a,o.lastSearches=s(),o.search&&o.find(o.search)}angular.module("gbif-search").controller("SearchController",["SearchService","$state",e])}(),function(){function e(e){var t="http://api.gbif.org/v1/species/match?verbose=true&name=",r="http://api.gbif.org/v1/species/suggest?q=";return{find:function(r){return e.get(t+r,{cache:!0})},suggest:function(t){return e.get(r+t)},storeLastSearch:function(e){var t=JSON.parse(localStorage.getItem("lastSearches"));_.isEmpty(t)?localStorage.setItem("lastSearches",JSON.stringify([e])):(t.push(e),localStorage.setItem("lastSearches",JSON.stringify(t)))},retrieveLastSearches:function(){var e=JSON.parse(localStorage.getItem("lastSearches"));return _.isEmpty(e)?void 0:_.uniq(JSON.parse(localStorage.getItem("lastSearches")).reverse())}}}angular.module("gbif-search").factory("SearchService",["$http",e])}();